## 概述

网络由若干结点和连接这些结点的链路组成。互联网是“网络的网络”。

### 因特网

组成：

* 边缘部分（主机又叫端系统，指连接在因特网上的计算机，为用户进行信息处理、发送和接收分组）
* 核心部分（路由器，对分组进行存储转发）

通信方式：

* 客户-服务器方式（C/S）
* 对等方式（P2P）

ps：internet（互联网），Internet（因特网）。

### 路由器

路由器是实现分组交换的关键构件，其任务是转发收到的分组。

路由器（输入和输出没有直接连线）主要做的工作：

* 收到的分组放入缓存
* 查找转发表
* 把分组送到适当的端口转发出去

### 计算机网络

定义：计算机网络是一些互相连接的、自治的计算机的集合。

* 带宽：数字信道所能传送的最高数据率。
* 吞吐量：在单位时间内通过某个网络（或信道、接口）的数据量（受带宽或速率限制）。
* 发送时延：数据帧长度（b）/发送速率（b/s）。
* 传播时延：信道长度（m）/传播速率（m/s）。
* 总时延：发送时延+传播时延+处理时延+排队时延（取决于网络当时通信量）.
* 网络当前时延：网络空闲时延/(1-网络利用率)。

### OSI七层模型

```
OSI           TCP/IP        OSI/RM
--------------------------------------
应用层
表示层        应用层        应用层      --->报文
会话层
--------------------------------------
运输层        运输层        运输层      --->报文段/用户数据报
--------------------------------------
网络层        网际层        网络层      --->IP数据报（分组）
--------------------------------------
数据链路层   网络接口层    数据链路层   --->帧
物理层                      物理层      --->比特
```

* 本层为上一层服务（垂直服务）
* 相邻两层实体交互的地方：服务访问点SAP
* 协议考虑了能想到的不利条件

## 物理层

* 通信：单向通信（单工）、双向交替通信（半双工）和双向同时通信（全双工）。
* 信号：基带信号（调制前）和带通信号（调制后）。
* 调制方法：调幅（AM）、调频（FM）和调相（PM）。
* 限制码云传输速率因素：信道能够通过的频率范围（奈示准则：码云传输速率有上限）和信噪比。

### 传输媒体

#### 导引型

* 双绞线：屏蔽双绞线STP（抗电磁干扰）和无屏蔽双绞线UTP。
* 同轴电缆
* 光缆：多磨光钎和单模光钎

#### 非导引型

主要指无线电波（可使用频段广）。

* 短波通信（高频通信）：靠电离层反射，通信质量差。
* 微波通信（直线传播）：地面微波接力通信和卫星通信。

### 复用

* 频分复用（FDM）
* 时分复用（TDM）
* 波分复用（WDM）
* 码分复用（CDM）

不同站码片序列不同，并且与其他站正交，与自己的规格化内积为1。把收到的信号直接与已知码片序列求规格化内积便可得到真正信号。

ps：ADSL-非对称数字用户线（上行和下行带宽不对称）。

## 数据链路层

* 信道：点对点信道和广播信道。
* 封装成帧：添加帧首部、帧尾部和转义。

MAC地址共48位，MAC帧格式如下：

```
| 目的MAC地址 | 源MAC地址 |   类型  |    ip数据报    | FCS（用于差错检测）|
|:----------:|:---------:|:------:|:--------------:|:----------------:|
|    6字节   |    6字节   |  2字节 | 46字节-1500字节 |      4字节        |
```

## 网络层

IP地址具体分类如下：

```
| 类型 |            网络号              |          主机号         |
|:---:|--------------------------------|:-----------------------:|
|  A  | '0'    + 7位（全0和127不可用）  |   24位（全0和全1不可用）  |
|  A  | '10'   + 14位（无不可用）       |   16位（全0和全1不可用）  |
|  A  | '110'  + 21位（192不可用）      |   8位（全0和全1不可用）   |
|  A  | '1110' + 28位（多播地址）       |           无             |
|  A  | '1111' + 28位（保留）           |           无            |
```

ps：ARP - 地址转换协议（自动进行）

IP数据报格式：

```
| 版本 | 首部长度 | 区分长度 | 总长度 |  标识 | 标志 | 片偏移 | 生存时间 |  协议 | 首部检验和 | 源IP地址 | 目的IP地址 | 可选 | 填充 | 数据 |
|:----:|:-------:|:-------:|:------:|:----:|:----:|:-----:|:--------:|:----:|:---------:|:--------:|:---------:|:----:|:----:|:---:|
|  4位 |   4位   |   1字节  |  2字节 | 2字节 | 3位  |  13位 |   1字节  | 1字节 |   2字节   |   4字节  |    4字节   | 可变 | 可变 |     |
```

* 固定部分为20字节。
* 片偏移以8个字节为偏移单位（片偏移 * 8 = 分片起始地址），分片长度必须为8的整数倍。
* 标志中最低位MF=1表示后面还有分片，中间位DF=1表示不能呢个分片。
* 路由表包含的内容：目的主机所在网络、下一跳地址（封装在MAC帧中）和子网掩码。
* 路由分为静态路由和动态路由。

## 运输层

### 端口

端口共16位，其中0-1023属保留端口，1024-49151可用。

### UDP

UDP报文格式：

```
| 源端口 | 目的端口 |  长度 | 检验和 |  数据 |
|:-----:|:--------:|:----:|:------:|:----:|
|  2字节 |  2字节  | 2字节 |  2字节 |       |
```

* 首部共8个字节。
* 检验和要用伪首部和首部加起来一起计算。

### TCP

TCP报文格式：

```
| 源端口 | 目的端口 |  序号 | 确认号 | 数据偏移 | 保留字段 | 标志 |  窗口 |  检验和 | 紧急指针 | 选项 | 填充 |  数据 |
|:-----:|:--------:|:----:|:------:|:-------:|:-------:|:----:|:-----:|:------:|:-------:|:----:|:----:|:----:|
|  2字节 |  2字节  | 4字节 |  4字节 |    4位   |   6位   |  6位 | 2字节 |  2字节 |   2字节  | 可变 |      |       |
```

* 固定首部20个字节。
* 数据偏移以4个字节为偏移单位。
* 检验和要用伪首部和首部加起来一起计算。

## 应用层

```
| 应用层协议 | 传输层协议 | 端口号 |
|:---------:|:---------:|:------:|
|    DNS    |    UDP    |   53   |
|    TFTP   |    UDP    |   69   |
|    DHCP   |    UDP    | 67、68 |
|    FTP    |    TCP    | 20、21 |
|    HTTP   |    TCP    |   80   |
|    POP3   |    TCP    |   110  |
|   IMAP4   |    TCP    |   143  |
|    SMTP   |    TCP    |   25   |
```

## 各层应用简介

* 物理层：转发器、调制解调器（接入Internet）、中继器（扩大传输距离）、集线器（多接口中继器，扩大传输距离）
* 链路层： 网桥、交换机（多接口网桥，转发）、网卡（适配器，用于接入局域网）
* 网络层：路由器（连接同类型不同网络）
* 传输层：防火墙、VPN、网关（本网标记，连接不同类型的网络）
