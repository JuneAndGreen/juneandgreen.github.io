## 概述

网络由若干结点和连接这些结点的链路组成。互联网是“网络的网络”。

### 因特网

组成：

* 边缘部分（主机又叫端系统，指连接在因特网上的计算机，为用户进行信息处理、发送和接收分组）
* 核心部分（路由器，对分组进行存储转发）

通信方式：

* 客户-服务器方式（C/S）
* 对等方式（P2P）

ps：internet（互联网），Internet（因特网）。

### 路由器

路由器是实现分组交换的关键构件，其任务是转发收到的分组。

路由器（输入和输出没有直接连线）主要做的工作：

* 收到的分组放入缓存
* 查找转发表
* 把分组送到适当的端口转发出去

### 计算机网络

定义：计算机网络是一些互相连接的、自治的计算机的集合。

* 带宽：数字信道所能传送的最高数据率。
* 吞吐量：在单位时间内通过某个网络（或信道、接口）的数据量（受带宽或速率限制）。
* 发送时延：数据帧长度（b）/发送速率（b/s）。
* 传播时延：信道长度（m）/传播速率（m/s）。
* 总时延：发送时延+传播时延+处理时延+排队时延（取决于网络当时通信量）.

### OSI七层模型

```
OSI           TCP/IP        OSI/RM
--------------------------------------
应用层
表示层        应用层        应用层      --->报文
会话层
--------------------------------------
运输层        运输层        运输层      --->报文段/用户数据报
--------------------------------------
网络层        网际层        网络层      --->IP数据报（分组）
--------------------------------------
数据链路层   网络接口层    数据链路层    --->帧
物理层                      物理层      --->比特
```

* 本层为上一层服务（垂直服务）
* 相邻两层实体交互的地方：服务访问点SAP
* 协议考虑了能想到的不利条件

## 物理层

涉及到物理层面的信息传输，规定了网络的电气特性，主要传输0和1的电信号。

## 数据链路层

封装数据成MAC帧，使用MAC地址标明接受者和发送者。

MAC地址共48位，MAC帧格式如下：

| 目的MAC地址 | 源MAC地址 |   类型  |    ip数据报    | FCS（用于差错检测）|
|:----------:|:---------:|:------:|:--------------:|:----------------:|
|    6字节   |    6字节   |  2字节 | 46字节-1500字节 |      4字节        |

## 网络层

IP（IPv4）地址具体分类如下：

| 类型 |            网络号              |          主机号         |
|:---:|--------------------------------|:-----------------------:|
|  A  | '0'    + 7位（全0和127不可用）  |   24位（全0和全1不可用）  |
|  A  | '10'   + 14位（无不可用）       |   16位（全0和全1不可用）  |
|  A  | '110'  + 21位（192不可用）      |   8位（全0和全1不可用）   |
|  A  | '1110' + 28位（多播地址）       |           无             |
|  A  | '1111' + 28位（保留）           |           无            |

ps：获取网络号的方式是将IP地址与子网掩码相与即可获得。
ps：ARP - 地址转换协议（自动进行，为了获取同一个子网络中的接收方的MAC地址，假如不处于同一个子网络中会由网关自行处理）

IP数据报格式：

| 版本 | 首部长度 | 区分长度 | 总长度 |  标识 | 标志 | 片偏移 | 生存时间 |  协议 | 首部检验和 | 源IP地址 | 目的IP地址 | 可选 | 填充 | 数据 |
|:----:|:-------:|:-------:|:------:|:----:|:----:|:-----:|:--------:|:----:|:---------:|:--------:|:---------:|:----:|:----:|:---:|
|  4位 |   4位   |   1字节  |  2字节 | 2字节 | 3位  |  13位 |   1字节  | 1字节 |   2字节   |   4字节  |    4字节   | 可变 | 可变 |     |

* 固定部分为20字节。
* 片偏移以8个字节为偏移单位（片偏移 * 8 = 分片起始地址），分片长度必须为8的整数倍。
* 标志中最低位MF=1表示后面还有分片，中间位DF=1表示不能呢个分片。
* 路由表包含的内容：目的主机所在网络、下一跳地址（封装在MAC帧中）和子网掩码。
* 路由分为静态路由和动态路由。

## 运输层

### 端口

端口共16位，其中0-1023属保留端口，1024-49151可用。

### UDP

UDP报文格式：

| 源端口 | 目的端口 |  长度 | 检验和 |  数据 |
|:-----:|:--------:|:----:|:------:|:----:|
|  2字节 |  2字节  | 2字节 |  2字节 |       |

* 首部共8个字节。
* 检验和要用伪首部和首部加起来一起计算。

### TCP

TCP报文格式：

| 源端口 | 目的端口 |  序号 | 确认号 | 数据偏移 | 保留字段 | 标志 |  窗口 |  检验和 | 紧急指针 | 选项 | 填充 |  数据 |
|:-----:|:--------:|:----:|:------:|:-------:|:-------:|:----:|:-----:|:------:|:-------:|:----:|:----:|:----:|
|  2字节 |  2字节  | 4字节 |  4字节 |    4位   |   6位   |  6位 | 2字节 |  2字节 |   2字节  | 可变 |      |       |

* 固定首部20个字节。
* 数据偏移以4个字节为偏移单位。
* 检验和要用伪首部和首部加起来一起计算。

## 应用层

### 常见协议端口号

| 应用层协议 | 传输层协议 | 端口号 |
|:---------:|:---------:|:------:|
|    DNS    |    UDP    |   53   |
|    TFTP   |    UDP    |   69   |
|    DHCP   |    UDP    | 67、68 |
|    FTP    |    TCP    | 20、21 |
|    HTTP   |    TCP    |   80   |
|    POP3   |    TCP    |   110  |
|   IMAP4   |    TCP    |   143  |
|    SMTP   |    TCP    |   25   |

### HTTP

#### 简介

HTTP由请求和响应构成，是一个标准的客户端服务器模型。HTTP是一个无状态的协议，web服务器只有在浏览器发送请求时才给予响应，浏览器的每次请求都是一次独立的存在，此次请求和之前的请求没有对应的关系，并且请求永远是由浏览器发送给web服务器，web服务器不会在没有请求的情况下响应浏览器。

HTTP协议通常承载于TCP协议之上，有时也承载于TLS协议（安全传输层协议，用于提供通信保密性和数据完整性）或SSL协议（安全套接字层协议，用于安全数据传输加密数据）层之上，这个时候，就成了我们常说的HTTPS。默认HTTP的端口号是80，HTTPS的端口号是443。

HTTP协议的工作流程如下：

```
建立连接 ----> 请求 ----> 响应 ----> 处理响应
```

#### 请求和响应

* 一般HTTP请求由请求行、消息报头、请求正文三个部分构成。请求行的格式：请求方法、请求URI、HTTP协议版本号。
* 一般HTTP响应则由状态行、消息报头、响应正文三个部分构成。状态行的格式：HTTP协议版本号、响应状态码、相应的状态描述。

#### 常见HTTP状态码

| 类型 | 解释         | 例子                                                               |
|-----|--------------|--------------------------------------------------------------------|
| 1xx | 请求信息      |                                                                   |
| 2xx | 请求成功      | 200 - 成功                                                         |
| 3xx | 跳转          | 301 - 永久跳转，302 - 临时跳转                                      |
| 4xx | 客户端请求异常 | 400 - 请求非法，403 - 禁止请求，404 - 请求不存在，405 - 方法不允许    |
| 5xx | 服务器异常    | 500 - 服务器异常，502 - 网关异常，503 - 服务器负载过重，504 - 网关超时 |

#### 常见HTTP方法

* 非幂等：POST
* 幂等：GET、DELETE、PUT

#### GET和POST的区别

1. get把请求参数附在url后，post把参数附在发送的请求信息体内；
2. get请求参数有限，因为url长度限制，post则没有限制；
3. 因为get请求参数会出现在url中，故安全性比post差很多；
4. 因为get请求参数会出现在url中，故欲把带请求参数的网页作为书签收藏必须使用get；
5. post可避免从缓存中读取旧数据，get如果想避免的话，必须另加时间戳；
6. get用于等幂操作，即每次请求都传回相同的结果，不改变服务器的状态，post用于非等幂操作，可改变服务器状态，如增、删、改数据库内容（post对于服务器是不安全的）。

## 各层应用简介

* 物理层：转发器、调制解调器（接入Internet）、中继器（扩大传输距离）、集线器（多接口中继器，扩大传输距离）
* 链路层： 网桥、交换机（多接口网桥，转发）、网卡（适配器，用于接入局域网）
* 网络层：路由器（连接同类型不同网络）
* 传输层：防火墙、VPN、网关（本网标记，连接不同类型的网络）
